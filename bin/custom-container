#!/bin/bash
# Creation of a container based on Ubuntu 
#####  MODIFICATIONS LIKELY TO BE REQUIRED IN THIS SECTION  #####

# Directory housing singularity definition file templates.
META=/sw/BUILD/metadata

# Directory where singularity image files will be placed.
INST=/sw/containers/

##### MODIFICATIONS UNLIKELY TO BE REQUIRED IN THIS SECTION #####

if [ $# -eq 1 -o $# -eq 2 ] ; then
    SOFT=$1

    VERS=$2   # Allow user to specify a version.

    # Create singularity definition file
    cat $META/ubuntu-22.04-base.template | sed -e s/SWNAME/$SOFT/g >/tmp/$SOFT.def

    # Build singularity container
    sudo singularity build /tmp/$SOFT-$VERS.sif /tmp/$SOFT.def
    cp /tmp/$SOFT-$VERS.sif $INST
    rm -f /tmp/$SOFT-$VERS.sif
else
    echo ""
    echo "Syntax:  ubuntu-container <sw_name> [<sw_vers>]"
    echo ""
    exit 1
fi
